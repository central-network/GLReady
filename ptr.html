<!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            body, html { 
                width: 100vw; height: 100vh; overflow: hidden;
                margin: 0; overscroll-behavior-x: none; }

            canvas { width: 100%; height: 100%; }
            table {
                position: fixed;
                right: 10px;
                top: 10px;
                font: 14px/1.38em "Ubuntu Mono";
            }

            * { border: 0; }
            td { position: relative; }

            *:focus { outline: 0; }
            td::before {
                content: attr(id) ":";
                position: absolute;
                right: 100%;
                pointer-events: none;
                color: rgb(152, 152, 152);
            }
        </style>
    </head>
    <body style="background: black;">
        <canvas></canvas>
        <table id="tbl">
            <tr><td id="dxCamera">   <input type="range" max="500" min="-500" step="1" /></td></tr>
            <tr><td id="dyCamera">   <input type="range" max="500" min="-500" step="1" /></td></tr>
            <tr><td id="dzCamera">   <input type="range" max="500" min="-500" step="1" /></td></tr>

            <tr><td id="rxCamera">   <input type="range" max="3.14" min="-3.14" step="0.01" /></td></tr>
            <tr><td id="ryCamera">   <input type="range" max="3.14" min="-3.14" step="0.01" /></td></tr>

            <tr><td id="sxCamera">   <input type="range" max="3" min="0" step="0.1" /></td></tr>
            <tr><td id="syCamera">   <input type="range" max="3" min="0" step="0.1" /></td></tr>
            <tr><td id="szCamera">   <input type="range" max="3" min="0" step="0.1" /></td></tr>
        </table>


        <script type="module">
            import { GL, Program, Shader, Buffer, Object3 } from "./ptr_gl.js"

            self.gl = null;
            self.vshader = null;
            self.program = null;
            self.buff = null;

            let canvas = document.querySelector( 'canvas' );
            let buffer = new SharedArrayBuffer( 1e8 );

            gl = new GL();
            program = new Program();

            gl.setCanvasNode( canvas ).bindEvents();
            gl.add( program );


            buff = new Buffer();
            gl.add( buff );
            buff.load();

            //gl.fork()
            
            gl.glCullEnabled    = true;
            gl.glCullFace       = WebGL2RenderingContext.CULL_FACE;
            gl.glFrontFace      = WebGL2RenderingContext.CCW;
            gl.glClearDepth     = 1.1;
            gl.glDepthTest      = WebGL2RenderingContext.DEPTH_TEST;
            gl.glDepthFunc      = WebGL2RenderingContext.LEQUAL;
            gl.glClearColor     = [ 15, 18, 26 ]
            gl.glBlendFunc      = WebGL2RenderingContext.BLEND;
            gl.glBlendEquation  = WebGL2RenderingContext.FUNC_ADD;
            gl.glBlendInArg     = WebGL2RenderingContext.SRC_COLOR;
            gl.glBlendOutArg    = WebGL2RenderingContext.DST_COLOR;
            gl.glBindTarget     = WebGL2RenderingContext.ARRAY_BUFFER;
            gl.glClearMask      =
                WebGL2RenderingContext.DEPTH_BUFFER_BIT |
                WebGL2RenderingContext.COLOR_BUFFER_BIT ;


            program.vertexShader = `
                attribute vec3     a_Vertex;
                attribute vec4     a_Color;
                uniform   float    u_PointSize;
                uniform   mat4     u_Camera;
                varying   vec4     v_Color;

                void main() {
                    gl_Position  =  u_Camera * vec4(a_Vertex, 1.0);
                    gl_PointSize =  10.0;
                    v_Color      =  a_Color;
                }
            `;

            program.fragmentShader = `
                precision highp    float;
                varying   vec4     v_Color;

                void main() {
                    gl_FragColor = v_Color;
                }
            `;
            
            log( gl );
            log( gl.program );
            log( buff );
            

            

            let o3 = Object3.from([
                3, 1, 2,
                -3, 1, 2,
                .3, 1, 22
            ]);

            o3.type = WebGL2RenderingContext.POINTS;

            let o32 = Object3.from(
                [
                    -3, 1, .2,
                    .3, 1, -22
                ]
            );

            o32.type = WebGL2RenderingContext.POINTS;
            o32.color = [ 1, 1, 0, 1 ];

            buff.alloc( o3 )
            buff.alloc( o32 )

            //gl.drawww( o32 );
            //gl.drawww( o3 );

            console.warn(o3)
            console.warn(o32)

        </script>

        <script aria-describedby="fingerprint auth demo">
            (async function (){

                let challenge = Uint8Array.of(
                    21, 31, 105, 141, 184, 113, 63, 63, 108, 84, 37, 12, 21, 24, 95, 94, 
                    41, 181, 238, 242, 91, 222, 224, 82, 92, 18, 53, 19, 57, 248, 5, 25
                );
                
                let rawId = Uint8Array.from((
                    localStorage.getItem("credential.rawId")??"").split(",")
                );                

                let firstfinger = async function () {
                    let { rawId } = await navigator.credentials.create({
                        publicKey: {
                            rp               : { id: "localhost", name: "Okyanus" },
                            challenge        : challenge,
                            user             : {
                                id           : Uint8Array.of( 79, 252, 83, 72, 214, 7, 89 ),
                                name         : "ozgur@central.network",
                                displayName  : "Özgür F\u0131rat Özpolat"
                            },
                            pubKeyCredParams : [ {type: "public-key", alg: -7} ]
                        }
                    });

                    localStorage.setItem( "credential.rawId", new Uint8Array( rawId ));
                };

                let fingerprint = async function () {
                    let getcreden = await navigator.credentials.get({
                        publicKey : {
                            rpId             : "localhost",
                            userVerification : "preferred",
                            challenge        : challenge,
                            allowCredentials : [{ type: "public-key", id: rawId }]
                        }
                    });

                    sessionStorage.setItem("credential.rawId", getcreden.id);
                    console.warn("session started with credentials:", getcreden);   
                };

                if ( sessionStorage.getItem("credential.rawId") ) {
                    onclick = fingerprint;
                }
                else
                if ( localStorage.getItem("credential.rawId") ) {
                    fingerprint();
                }
                else
                    firstfinger();
                                
            })();
        </script>
        
    </body>
</html>